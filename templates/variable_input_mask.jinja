{% extends 'base.html' %}

{% block content %}
    <h1>{% block title %} {{ toolName }} {% endblock %}</h1>
    
    {% if toolName == "QR-Code Generator" %}
    <div class="alert alert-info">
        Geben Sie Text oder eine URL ein, um einen QR-Code zu generieren. 
        Die Fehlerkorrektur bestimmt, wie gut der QR-Code auch bei Beschädigung noch lesbar ist.
    </div>
    {% endif %}

    {% if toolName == "Zahlenkonverter" %}
    <div class="alert alert-info">
        Geben Sie eine Zahl ein und wählen Sie den entsprechenden Zahlentyp aus.
        Das Tool wird die Zahl automatisch in die anderen Formate konvertieren.
    </div>
    {% endif %}

    {% if toolName == "Bildkonverter" %}
    <div class="alert alert-info">
        Laden Sie ein Bild hoch und wählen Sie das gewünschte Zielformat aus.
        Unterstützte Formate sind: PNG, JPEG, GIF, BMP und WEBP.
    </div>
    {% endif %}
    
    {% if toolName == "Passwortgenerator" %}
    <div class="alert alert-info">
        Wählen Sie die gewünschte Länge und die zu verwendenden Zeichentypen für Ihr sicheres Passwort aus.
        Ein starkes Passwort sollte mindestens 12 Zeichen lang sein und verschiedene Zeichentypen enthalten.
    </div>
    {% endif %}
    
    <br>
    <form action="{{ url_for('handle_tool') }}" method="post" enctype="multipart/form-data" id="toolForm">
    <input type="hidden" name="tool_name" value="{{ identifier }}">
    {% for param, param_type in input_params.items() %}
        {% if param_type == 'string' %}
            {% if param == "number" and identifier == "NumberConverterTool" %}
                <label for="{{ param }}">Zahl:</label>
            {% elif param == "input_type" and identifier == "NumberConverterTool" %}
                <label for="{{ param }}">Zahlentyp:</label>
            {% elif param == "target_format" and identifier == "ImageConverterTool" %}
                <div class="form-group target-format-group" style="display: none;">
                    <label for="{{ param }}">Zielformat:</label>
                    <select name="{{ param }}" id="{{ param }}" class="form-control">
                        <option value="" disabled selected>Bitte wählen Sie ein Format</option>
                    </select>
                </div>
            {% elif param == "length" and identifier == "PasswordGeneratorTool" %}
                <label for="{{ param }}">Passwortlänge:</label>
                <input type="number" name="{{ param }}" id="{{ param }}" value="12" min="4" max="128" class="form-control">
                <small class="form-text text-muted">Wählen Sie eine Länge zwischen 4 und 128 Zeichen (12+ empfohlen)</small>
            {% else %}
                <label for="{{ param }}">{{ param }}:</label>
            {% endif %}
            
            {% if param == "error_correction" and identifier == "QrCodeGeneratorTool" %}
                <select name="{{ param }}" id="{{ param }}" class="form-control">
                    <option value="L">Niedrig (L) - 7% Korrektur</option>
                    <option value="M" selected>Mittel (M) - 15% Korrektur</option>
                    <option value="Q">Quartil (Q) - 25% Korrektur</option>
                    <option value="H">Hoch (H) - 30% Korrektur</option>
                </select>
            {% elif param == "box_size" and identifier == "QrCodeGeneratorTool" %}
                <input type="number" name="{{ param }}" id="{{ param }}" value="10" min="1" max="50" class="form-control">
            {% elif param == "border" and identifier == "QrCodeGeneratorTool" %}
                <input type="number" name="{{ param }}" id="{{ param }}" value="4" min="0" max="10" class="form-control">
            {% elif param == "text" and identifier == "QrCodeGeneratorTool" %}
                <input type="text" name="{{ param }}" id="{{ param }}" placeholder="Text oder URL eingeben" class="form-control">
            {% elif param == "input_type" and identifier == "NumberConverterTool" %}
                <select name="{{ param }}" id="{{ param }}" class="form-control">
                    <option value="binary">Binär</option>
                    <option value="decimal">Dezimal</option>
                    <option value="hexadecimal">Hexadezimal</option>
                </select>
            {% elif param == "number" and identifier == "NumberConverterTool" %}
                <input type="text" name="{{ param }}" id="{{ param }}" placeholder="Geben Sie eine Zahl ein" class="form-control">
            {% elif param == "target_format" and identifier == "ImageConverterTool" %}
                <!-- Format selection is handled above -->

            
            {% endif %}
        {% elif param_type == 'boolean' %}
            {% if identifier == "PasswordGeneratorTool" %}
                <div class="form-check mb-2">
                    <input type="checkbox" class="form-check-input" name="{{ param }}" id="{{ param }}" checked>
                    {% if param == "include_lowercase" %}
                        <label class="form-check-label" for="{{ param }}">Kleinbuchstaben einschließen (a-z)</label>
                    {% elif param == "include_uppercase" %}
                        <label class="form-check-label" for="{{ param }}">Großbuchstaben einschließen (A-Z)</label>
                    {% elif param == "include_numbers" %}
                        <label class="form-check-label" for="{{ param }}">Zahlen einschließen (0-9)</label>
                    {% elif param == "include_special" %}
                        <label class="form-check-label" for="{{ param }}">Sonderzeichen einschließen (!@#$%^&*...)</label>
                    {% else %}
                        <label class="form-check-label" for="{{ param }}">{{ param }}</label>
                    {% endif %}
                </div>
            {% else %}
                <label for="{{ param }}">{{ param }}:</label>
                <input type="checkbox" name="{{ param }}" id="{{ param }}">
            {% endif %}
        {% elif param_type == 'file' %}
            {% if identifier == "ImageConverterTool" %}
                <div class="form-group">
                    <label for="{{ param }}">Bild auswählen:</label>
                    <input type="file" name="{{ param }}" id="{{ param }}" class="form-control" accept="image/*" onchange="handleImageSelect(this)">
                    <small class="form-text text-muted">Unterstützte Formate: PNG, JPEG, GIF, BMP, WEBP</small>
                </div>
                <div id="progressContainer" style="display: none;">
                    <div class="progress">
                        <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%"></div>
                    </div>
                </div>
            {% else %}
                <label for="{{ param }}">{{ param }}:</label>
                <input type="file" name="{{ param }}" id="{{ param }}">
            {% endif %}
        {% endif %}
        <br>
    {% endfor %}
    
    {% if identifier == "PasswordGeneratorTool" %}
    <div class="alert alert-warning mt-3">
        <strong>Hinweis:</strong> Passwörter werden lokal generiert und nicht an den Server übertragen.
        Kopieren Sie Ihr Passwort sofort nach der Erstellung, es wird nicht gespeichert.
    </div>
    <input class="fancy-button" type="submit" value="Passwort generieren" id="submitButton">
    {% else %}
    <input class="fancy-button" type="submit" value="Konvertieren" id="submitButton">
    {% endif %}
    
    </form>

    {% if identifier == "ImageConverterTool" %}
    <script>
    function handleImageSelect(input) {
        if (input.files && input.files[0]) {
            const file = input.files[0];
            const format = file.name.split('.').pop().toUpperCase();
            const formatSelect = document.querySelector('select[name="target_format"]');
            const formatGroup = document.querySelector('.target-format-group');
            
            // Clear existing options
            formatSelect.innerHTML = '<option value="" disabled selected>Bitte wählen Sie ein Format</option>';
            
            // Add available formats except the current one
            const formats = ['PNG', 'JPEG', 'GIF', 'BMP', 'WEBP'];
            formats.forEach(fmt => {
                if (fmt !== format) {
                    const option = document.createElement('option');
                    option.value = fmt;
                    option.textContent = fmt;
                    formatSelect.appendChild(option);
                }
            });
            
            formatGroup.style.display = 'block';
        }
    }

    document.getElementById('toolForm').onsubmit = function() {
        document.getElementById('progressContainer').style.display = 'block';
        document.getElementById('submitButton').disabled = true;
        
        // Simulate progress (in real application, this would be updated by the server)
        let progress = 0;
        const progressBar = document.querySelector('.progress-bar');
        const interval = setInterval(() => {
            progress += 5;
            if (progress <= 90) {
                progressBar.style.width = progress + '%';
                progressBar.setAttribute('aria-valuenow', progress);
            }
        }, 100);
        
        return true;
    };
    </script>
    {% endif %}
{% endblock %}  